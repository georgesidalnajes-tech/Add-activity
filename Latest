<!DOCTYPE html>
<html>
<head>
  <title>Add Activity</title>
  <base target="_top">
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background-color: #f8f8f8; /* Reverted background color to light gray */
    }
    h2 {
      margin-top: 5px;
      background-color: #f2f2f2;
      padding: 0 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100%;
    }
    h3 {
      margin-bottom: 0;
      margin-top: 20px;
      font-weight: bold;
    }
    h4 {
      margin-bottom: 0;
      font-weight:bold;
    }
    .form-group {
      margin-top: 5px;
      margin-bottom: 5px;
      display: flex;
      flex-direction: column;
      flex: 1; /* Ensures equal distribution in a flex row */
    }
    .form-group label {
      margin-bottom: 4px;
      font-weight: lighter;
    }
    /* New style for bold labels */
    .bold-label {
        font-weight: bold !important; /* !important to override .form-group label */
    }
    input[type="text"], input[type="number"], select, textarea, input[type="email"] {
      padding: 6px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-family: Arial, sans-serif;
      text-transform: uppercase;
      box-sizing: border-box;
      width: 100%; /* Default width for all inputs except date */
    }
    /* Adjusted style for date input to match other text inputs' width */
    input[type="date"] {
      padding: 6px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-family: Arial, sans-serif;
      text-transform: uppercase;
      box-sizing: border-box;
      width: 100%; /* Now takes full width of its container */
      display: block; /* Ensures it behaves as a block element for layout */
      margin: 0; /* Remove auto margins to allow it to fill space */
    }
    textarea {
      resize: vertical;
    }
    .row {
      display: flex;
      gap: 15px; /* Adjust gap for better spacing */
      margin-bottom: 10px; /* Adjust margin for rows */
      flex-wrap: wrap; /* Allow items to wrap on smaller screens */
    }
    .ownership-input {
      flex: 4; /* Gives more space to this input */
    }
    .checkbox-row, .radio-row { /* Added .radio-row */
      display: flex;
      gap: 20px;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    .other-convergence-input, .partnership-input {
      margin-left: 20px; /* Indent the text area for "Other" */
      flex: 1; /* Allow it to take up available space */
      max-width: 200px; /* Ensure it stays short */
    }
    /* Removed .partnership-options specific styles as it's no longer a hidden container */
    .partnership-option-row {
        display: flex;
        align-items: center;
        gap: 10px;
        flex-wrap: wrap;
        margin-left: 20px; /* Indent options under Partnership heading */
        margin-bottom: 10px; /* Space between partnership options */
    }
    button {
      margin-top: 20px;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      background-color: #007bff;
      color: white;
      font-size: 14px;
      font-family: Arial, sans-serif;
      cursor: pointer;
      transition: background-color 0.2s ease; /* Smooth transition for hover */
    }
    button:hover {
      background-color: #0056b3;
    }
    #loadingOverlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      height: 100%;
      width: 100%;
      background-color: rgba(255, 255, 255, 0.9);
      z-index: 9999;
      justify-content: center;
      align-items: center;
      font-size: 20px;
      font-weight: bold;
      color: #333;
    }
    .simple-box {
      border: 1px solid #ccc;
      padding: 30px 20px 20px;
      margin: 5px 0;
      position: relative;
    }
    .box-title {
      position: absolute;
      top: -10px;
      left: 10px;
      background-color: white;
      padding: 0 5px;
      font-size: 18px;
      font-weight: bold;
      line-height: 1;
    }
    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background-color: #f2f2f2;
      padding: 0 10px;
      width: 100%;
      margin-top: 20px;
    }
    .section-header h2 {
      margin: 0;
      padding: 10px 0;
    }
    .activity-fieldset {
        margin-top: 20px;
        padding: 10px;
        border: 1px solid #ccc;
        background-color: #f2f2f2;
        position: relative; /* Needed for absolute positioning of remove button */
    }
    .activity-fieldset legend {
        font-weight: bold;
    }
    /* Style for the "Add New Activity" button */
    .add-activity-instance-btn {
        margin-top: 15px;
        padding: 8px 15px;
        background-color: #28a745; /* Green color */
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
    }
    .add-activity-instance-btn:hover {
        background-color: #218838;
    }

    /* Base styles for tables (can be overridden by specific classes) */
    .company-table, .lmc-project-table, .issues-addressed-table, .pre-facilitation-discussion-table, .enhancement-discussion-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
    }
    .company-table th, .company-table td,
    .lmc-project-table th, .lmc-project-table td,
    .issues-addressed-table th, .issues-addressed-table td,
    .pre-facilitation-discussion-table th, .pre-facilitation-discussion-table td,
    .enhancement-discussion-table th, .enhancement-discussion-table td {
        border: 1px solid #ddd;
        padding: 8px;
        vertical-align: top;
        text-align: left;
    }
    /* Default bold for these tables */
    .company-table th {
        text-align: center;
        font-weight: bold;
    }
    /* Specific overrides for Discussion Details and Participating Companies tables (unbolded) */
    .pre-facilitation-discussion-table th,
    .enhancement-discussion-table th,
    .company-table.pre-facilitation-company-table th,
    .company-table.enhancement-company-table th {
        text-align: center;
        font-weight: normal;
    }
    /* Specific overrides for LMC Projects Implemented and Issues Addressed tables (unbolded) */
    .lmc-project-table th,
    .issues-addressed-table th {
        text-align: center;
        font-weight: normal;
    }


    .company-table input[type="text"], .company-table select, .company-table input[type="number"],
    .lmc-project-table input[type="text"], .lmc-project-table input[type="date"], .lmc-project-table textarea,
    .issues-addressed-table input[type="text"], .issues-addressed-table input[type="date"],
    .pre-facilitation-discussion-table input[type="text"], .pre-facilitation-discussion-table select, .pre-facilitation-discussion-table textarea,
    .enhancement-discussion-table input[type="text"], .enhancement-discussion-table select, .enhancement-discussion-table textarea {
        width: 100%;
        box-sizing: border-box;
        padding: 6px;
        border-radius: 4px;
        border: 1px solid #ccc;
    }
    .company-table textarea,
    .lmc-project-table textarea,
    .issues-addressed-table textarea,
    .pre-facilitation-discussion-table textarea,
    .enhancement-discussion-table textarea {
        resize: vertical;
        min-height: 30px;
    }
    .company-table td.remove-cell,
    .lmc-project-table td.remove-cell,
    .issues-addressed-table td.remove-cell,
    .pre-facilitation-discussion-table td.remove-cell,
    .enhancement-discussion-table td.remove-cell {
      text-align: center;
      vertical-align: middle;
      padding: 0;
    }
    .company-table td.remove-cell button,
    .lmc-project-table td.remove-cell button,
    .issues-addressed-table td.remove-cell button,
    .pre-facilitation-discussion-table td.remove-cell button,
    .enhancement-discussion-table td.remove-cell button {
        padding: 4px 8px;
        font-size: 14px;
        margin: 0;
    }

    /* Column widths for Pre-Facilitation Company table */
    .company-table.pre-facilitation-company-table .col-company-name { width: 25%; } /* Adjusted width */
    .company-table.pre-facilitation-company-table .col-category { width: 8%; } /* Adjusted width */
    .company-table.pre-facilitation-company-table .col-filed-case, .company-table.pre-facilitation-company-table .col-filed-rfa { width: 8%; } /* Adjusted width */
    .company-table.pre-facilitation-company-table .col-participants-header { width: 20%; } /* Adjusted width */
    .company-table.pre-facilitation-company-table .col-iec-materials { width: 10%; } /* New width */
    .company-table.pre-facilitation-company-table .col-remove { width: 10%; } /* Adjusted width */

    /* Column widths for Enhancement Company table */
    .company-table.enhancement-company-table .col-company-name { width: 12%; } /* Adjusted width */
    .company-table.enhancement-company-table .col-lmc-name { width: 12%; } /* Adjusted width */
    .company-table.enhancement-company-table .col-category { width: 8%; } /* Adjusted width */
    .company-table.enhancement-company-table .col-filed-case, .company-table.enhancement-company-table .col-filed-rfa { width: 8%; } /* Adjusted width */
    .company-table.enhancement-company-table .col-participants-header { width: 20%; } /* Adjusted width */
    .company-table.enhancement-company-table .col-iec-materials { width: 10%; } /* New width */
    .company-table.enhancement-company-table .col-remove { width: 10%; } /* Adjusted width */

    /* Column widths for Pre-Facilitation Discussion Table */
    .pre-facilitation-discussion-table .pre-dis-col-category { width: 15%; }
    .pre-facilitation-discussion-table .pre-dis-col-topics { width: 30%; }
    .pre-facilitation-discussion-table .pre-dis-col-discussed-by { width: 20%; }
    .pre-facilitation-discussion-table .pre-dis-col-details { width: 25%; }
    .pre-facilitation-discussion-table .pre-dis-col-remove { width: 10%; }

    /* Column widths for Enhancement Discussion Table */
    .enhancement-discussion-table .enh-dis-col-category { width: 15%; }
    .enhancement-discussion-table .enh-dis-col-topics { width: 30%; }
    .enhancement-discussion-table .enh-dis-col-discussed-by { width: 20%; }
    .enhancement-discussion-table .enh-dis-col-details { width: 25%; }
    .enhancement-discussion-table .enh-dis-col-remove { width: 10%; }

    /* Column widths for Monitoring LMC Projects Implemented table */
    .lmc-project-table .col-lmc-project { width: 20%; }
    .lmc-project-table .col-project-title { width: 25%; }
    .lmc-project-table .col-date-implemented { width: 15%; }
    .lmc-project-table .col-details { width: 30%; }
    .lmc-project-table .col-action { width: 10%; }


    /* Style for the smaller, normal font weight text in table header */
    .sub-header-text {
        font-weight: normal;
        font-size: 0.85em; /* Adjust as needed for desired smaller size */
    }

    /* Style for deletion details container */
    .deletion-details {
        display: flex;
        flex-direction: column;
        gap: 5px;
        margin-top: 5px;
    }
    .deletion-details input,
    .deletion-details textarea {
        width: 100%;
        box-sizing: border-box;
    }
    .hidden-field {
        display: none;
    }

    /* Style for autofilled company details box in Monitoring Activity */
    .autofill-company-box {
        border: 1px solid #d3d3d3; /* Light grey border */
        padding: 15px;
        margin-top: 10px; /* Consistent small space between these themed boxes */
        background-color: #f5f5f5; /* Slightly different background */
        border-radius: 8px;
    }

    .autofill-company-box h3 {
        margin-top: 0; /* Remove default top margin from h3 inside box */
        margin-bottom: 10px; /* Keep some space below the main heading in the box */
        font-size: 1.2em; /* Ensure it's clearly a heading */
    }

    /* New style for LMC Projects sub-section titles (now not used for individual tables) */
    .lmc-sub-section-title {
        font-size: 1.1em; /* Slightly smaller than h3, larger than regular text */
        font-weight: bold;
        margin-top: 10px; /* Small space above sub-section title */
        margin-bottom: 5px; /* Small space below sub-section title */
        color: #333; /* Good contrast */
    }

    .lmc-project-table + .add-activity-instance-btn { /* Style for button immediately following table */
        margin-top: 5px; /* Bring button closer to the table */
        margin-bottom: 10px; /* Space between this button and next element, if any */
    }

    /* Style for Issues Addressed table */
    .issues-addressed-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 5px;
      margin-bottom: 0px;
      table-layout: fixed; /* Added this line */
    }
    .issues-addressed-table th, .issues-addressed-table td {
      border: 1px solid #ddd;
      padding: 8px;
      vertical-align: top;
      text-align: left;
    }
    .issues-addressed-table th {
      text-align: center;
      font-size: 0.9em; /* Smaller font for headers */
      line-height: 1.2; /* Tighter line height for multi-line headers */
    }
    .issues-addressed-table input[type="text"],
    .issues-addressed-table input[type="date"] {
      width: 100%;
      box-sizing: border-box;
      padding: 6px;
      border-radius: 4px;
      border: 1px solid #ccc;
      min-height: 30px;
    }
    .issues-addressed-table td.remove-cell button {
      padding: 4px 8px;
      font-size: 14px;
      margin: 0;
    }
    /* Column widths for Issues Addressed table */
    .issues-addressed-table .col-issues-topics { width: 20%; }
    .issues-addressed-table .col-date-raised,
    .issues-addressed-table .col-date-settled,
    .issues-addressed-table .col-date-elevated,
    .issues-addressed-table .col-date-settled-gm { width: 10%; }
    .issues-addressed-table .col-referred-forums { width: 30%; }
    .issues-addressed-table .col-action { width: 10%; }

    /* New CSS for smaller, italicized text in table headers */
    .smaller-italic-text {
        font-size: calc(1em - 2pt); /* Decrease by 2pt from current font size */
        font-style: italic;
    }

    /* Style for the "Remove Activity" button within fieldsets */
    .remove-activity-fieldset-btn {
        margin-top: 15px;
        padding: 8px 15px;
        background-color: #dc3545; /* Red color for delete action */
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
        float: right; /* Float to the right to separate it */
        clear: both; /* Clear any floats above it */
    }
    .remove-activity-fieldset-btn:hover {
        background-color: #c82333;
    }


    /* Responsive adjustments for mobile */
    @media (max-width: 768px) {
      .row {
        flex-direction: column; /* Stack form groups vertically */
        gap: 10px;
      }
      .form-group, .ownership-input, .small-input-1 {
        width: 100%; /* Full width on small screens */
      }
      .remove-activity-fieldset-btn {
          float: none; /* Remove float on small screens */
          width: 100%; /* Make it full width */
          margin-left: 0;
          margin-right: 0;
      }
    }

    /* Custom Confirmation Modal Styles */
    #confirmationOverlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      height: 100%;
      width: 100%;
      background-color: rgba(0, 0, 0, 0.5); /* Semi-transparent black overlay */
      z-index: 10000; /* Higher than loading overlay */
      justify-content: center;
      align-items: center;
    }
    .confirmation-modal {
      background-color: white;
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      text-align: center;
      max-width: 400px;
      width: 90%;
      animation: fadeIn 0.3s ease-out;
    }
    .confirmation-modal p {
      margin-bottom: 25px;
      font-size: 1.1em;
      color: #333;
    }
    .confirmation-modal-buttons button {
      margin: 0 10px;
      padding: 10px 25px;
      border-radius: 6px;
      font-size: 1em;
      cursor: pointer;
      transition: background-color 0.2s ease, transform 0.1s ease;
    }
    .confirmation-modal-buttons button.yes-btn {
      background-color: #dc3545; /* Red for "Yes" to remove */
      color: white;
      border: none;
    }
    .confirmation-modal-buttons button.yes-btn:hover {
      background-color: #c82333;
      transform: translateY(-1px);
    }
    .confirmation-modal-buttons button.no-btn {
      background-color: #6c757d; /* Gray for "No" to cancel */
      color: white;
      border: none;
    }
    .confirmation-modal-buttons button.no-btn:hover {
      background-color: #5a6268;
      transform: translateY(-1px);
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.9); }
      to { opacity: 1; transform: scale(1); }
    }
  </style>
</head>
<body>
  <form id="activityForm" onsubmit="handleSubmit(event)">
    <div id="loadingOverlay">Submitting. Please wait.</div>

    <div class="simple-box">
        <h3 class="box-title">Activity Type</h3>
        <div class="form-group">
            <select id="activityTypeSelect" name="mainActivityType" onchange="displayActivityFields()">
                <option value="">Select an activity...</option>
                <option value="PRE-FACILITATION ACTIVITY">PRE-FACILITATION ACTIVITY</option>
                <option value="FACILITATION ACTIVITY">FACILITATION ACTIVITY</option>
                <option value="ENHANCEMENT ACTIVITY">ENHANCEMENT ACTIVITY</option>
                <option value="MONITORING ACTIVITY">MONITORING ACTIVITY</option>
                <option value="OTHER ADVOCACY & NETWORKING ACTIVITIES">OTHER ADVOCACY & NETWORKING ACTIVITIES</option>
            </select>
        </div>
    </div>

    <div id="activityFieldsContainer">
      <!-- Activity-specific fields will be loaded here -->
    </div>

    <button type="submit">Submit Activity</button>
  </form>

  <!-- Custom Confirmation Modal -->
  <div id="confirmationOverlay">
    <div class="confirmation-modal">
      <p id="confirmationMessage">Are you sure you want to remove this activity?</p>
      <div class="confirmation-modal-buttons">
        <button class="yes-btn" onclick="confirmRemoval()">Yes</button>
        <button class="no-btn" onclick="cancelRemoval()">No</button>
      </div>
    </div>
  </div>
  <!---------------------------->

  <script>
    let preFacilitationActivityCount = 0; // Counter for PRE-FACILITATION ACTIVITY instances
    let enhancementActivityCount = 0; // Counter for ENHANCEMENT ACTIVITY instances
    let monitoringActivityCount = 0; // Counter for MONITORING ACTIVITY instances
    let otherAdvocacyNetworkingCount = 0; // Counter for OTHER ADVOCACY & NETWORKING ACTIVITIES instances

    // Counters for LMC projects within monitoring activity
    let monitoringLmcProjectRowCount = []; // New single counter for LMC Projects Implemented table
    // New counter for Issues Addressed table
    let issuesAddressedRowCount = [];
    // New counters for Discussion tables
    let preFacilitationDiscussionRowCount = [];
    let enhancementDiscussionRowCount = [];

    let elementToRemove = null; // Variable to store the element to be removed

    // Mock data for demonstration purposes. In a real scenario, this would come from Google Apps Script.
    // Structure: { companyName: [LMC1, LMC2, ...], ... }
    const MOCK_COMPANY_LMC_DATA = {
        "Company A": ["LMC A1", "LMC A2"],
        "Company B": ["LMC B1", "LMC B2", "LMC B3"],
        "Company C": ["LMC C1"],
        "Other Company": ["General LMC"]
    };
    const MOCK_COMPANIES = Object.keys(MOCK_COMPANY_LMC_DATA); // Just the company names

    // Mock data for full company details based on company name and LMC name
    const MOCK_FULL_COMPANY_DETAILS = {
        "Company A": {
            "LMC A1": {
                category: "Organized",
                acronym: "CA1",
                filedCase: "Yes",
                filedRFA: "No",
                address: {
                    building: "Bldg A", street: "Street A", barangay: "Brgy A",
                    municipality: "Mun A", province: "Prov A", ecozone: "Yes"
                },
                industry: {
                    section: "AGRICULTURE, FORESTRY AND FISHING",
                    division: "CROP PRODUCTION",
                    group: "GROWING OF CROPS",
                    class: "GROWING OF CEREALS",
                    subclass: "LEGUMINOUS CROPS"
                }
            },
            "LMC A2": {
                category: "Unorganized",
                acronym: "CA2",
                filedCase: "No",
                filedRFA: "Yes",
                address: {
                    building: "Bldg B", street: "Street B", barangay: "Brgy B",
                    municipality: "Mun B", province: "Prov B", ecozone: "No"
                },
                industry: {
                    section: "MANUFACTURING",
                    division: "FOOD MANUFACTURING",
                    group: "BAKERY PRODUCTS",
                    class: "BREAD MAKING",
                    subclass: "ARTISAN BREAD"
                }
            }
        },
        "Company B": {
            "LMC B1": {
                category: "Organized",
                acronym: "CB1",
                filedCase: "No",
                filedRFA: "No",
                address: {
                    building: "Bldg C", street: "Street C", barangay: "Brgy C",
                    municipality: "Mun C", province: "Prov C", ecozone: "Yes"
                },
                industry: {
                    section: "MANUFACTURING",
                    division: "FOOD MANUFACTURING",
                    group: "BAKERY PRODUCTS",
                    class: "BREAD MAKING",
                    subclass: "PACKAGED BREAD"
                }
            }
        },
        "Company C": {
            "LMC C1": {
                category: "Organized",
                acronym: "CC1",
                filedCase: "Yes",
                filedRFA: "Yes",
                address: {
                    building: "Unit 1", street: "Main St", barangay: "Centro",
                    municipality: "Cityville", province: "State", ecozone: "No"
                },
                industry: {
                    section: "AGRICULTURE, FORESTRY AND FISHING",
                    division: "CROP PRODUCTION",
                    group: "GROWING OF CROPS",
                    class: "GROWING OF CEREALS",
                    subclass: "GROUNDNUTS"
                }
            }
        },
        "Other Company": {
            "General LMC": {
                category: "Unorganized",
                acronym: "OC",
                filedCase: "No",
                filedRFA: "No",
                address: {
                    building: "HQ", street: "Corporate Ave", barangay: "North",
                    municipality: "Metropolis", province: "Region", ecozone: "Yes"
                },
                industry: {
                    section: "MANUFACTURING",
                    division: "FOOD MANUFACTURING",
                    group: "BAKERY PRODUCTS",
                    class: "BREAD MAKING",
                    subclass: "ARTISAN BREAD"
                }
            }
        }
    };


    // Industry cascade data (reused from company_entry_form)
    const industryData = {
      "AGRICULTURE, FORESTRY AND FISHING": {
        "CROP PRODUCTION": {
          "GROWING OF CROPS": {
            "GROWING OF CEREALS": ["LEGUMINOUS CROPS", "GROUNDNUTS"]
          }
        }
      },
      "MANUFACTURING": {
        "FOOD MANUFACTURING": {
          "BAKERY PRODUCTS": {
            "BREAD MAKING": ["ARTISAN BREAD", "PACKAGED BREAD"]
          }
        }
      }
    };

    function populateSelect(selectElement, items, selectedValue = '') {
      selectElement.innerHTML = `<option value="">Select...</option>`;
      items.forEach(i => {
        const option = new Option(i, i);
        if (i === selectedValue) {
          option.selected = true;
        }
        selectElement.add(option);
      });
    }

    function updateIndustryDropdowns(fieldsetIndex, type) {
      const sectionSelect = document.getElementById(`${type}IndustrySection_${fieldsetIndex}`);
      const divisionSelect = document.getElementById(`${type}IndustryDivision_${fieldsetIndex}`);
      const groupSelect = document.getElementById(`${type}IndustryGroup_${fieldsetIndex}`);
      const classSelect = document.getElementById(`${type}IndustryClass_${fieldsetIndex}`);
      const subclassSelect = document.getElementById(`${type}IndustrySubclass_${fieldsetIndex}`);

      const sectionVal = sectionSelect.value;
      const divisionVal = divisionSelect.value;
      const groupVal = groupSelect.value;
      const classVal = classSelect.value;

      if (sectionVal) {
        populateSelect(divisionSelect, Object.keys(industryData[sectionVal]), divisionVal);
      } else {
        populateSelect(divisionSelect, []);
      }
      
      if (sectionVal && divisionVal) {
        populateSelect(groupSelect, Object.keys(industryData[sectionVal][divisionVal]), groupVal);
      } else {
        populateSelect(groupSelect, []);
      }

      if (sectionVal && divisionVal && groupVal) {
        populateSelect(classSelect, Object.keys(industryData[sectionVal][divisionVal][groupVal]), classVal);
      } else {
        populateSelect(classSelect, []);
      }

      if (sectionVal && divisionVal && groupVal && classVal) {
        populateSelect(subclassSelect, industryData[sectionVal][divisionVal][groupVal][classVal], subclassSelect.value);
      } else {
        populateSelect(subclassSelect, []);
      }
    }

    function toggleInputFieldVisibility(checkboxId, inputId) {
        const checkbox = document.getElementById(checkboxId);
        const inputField = document.getElementById(inputId);
        if (checkbox && inputField) {
            if (checkbox.checked) {
                inputField.classList.remove('hidden-field');
                inputField.setAttribute('required', 'true');
            } else {
                inputField.classList.add('hidden-field');
                inputField.removeAttribute('required');
                inputField.value = ''; // Clear the value when hidden
            }
        }
    }

    function toggleContainerVisibility(checkboxId, containerId) {
        const checkbox = document.getElementById(checkboxId);
        const container = document.getElementById(containerId);
        if (checkbox && container) {
            if (checkbox.checked) {
                container.classList.remove('hidden-field');
            } else {
                container.classList.add('hidden-field');
                container.querySelectorAll('input[type="checkbox"]').forEach(subCheckbox => {
                    if (subCheckbox.checked) {
                        subCheckbox.checked = false;
                        const associatedInputId = subCheckbox.id.replace('Checkbox', 'Text');
                        toggleInputFieldVisibility(subCheckbox.id, associatedInputId);
                    }
                });
            }
        }
    }

    function generatePreFacilitationFields(fieldsetIndex) {
      window[`companyTableRowCount_preFacilitation_${fieldsetIndex}`] = 0;
      preFacilitationDiscussionRowCount[fieldsetIndex] = 0;

      return `
        <fieldset class="activity-fieldset">
          <legend>PRE-FACILITATION ACTIVITY ${fieldsetIndex + 1}</legend>
          <div class="form-group">
            <label>Activity</label>
            <select name="preFacilitationActivityType_${fieldsetIndex}" required>
              <option value="">Select Activity</option>
              <option value="Area-Wide Seminar">Area-Wide Seminar</option>
              <option value="Plant-Level Orientation Seminar">Plant-Level Orientation Seminar</option>
              <option value="Consultation-Meeting">Consultation-Meeting</option>
            </select>
          </div>
          <div class="row">
              <div class="form-group">
                  <label>Activity Title</label>
                  <input type="text" name="preFacilitationActivityTitle_${fieldsetIndex}" required>
              </div>
              <div class="form-group">
                  <label>Date Conducted</label>
                  <div style="display: flex; gap: 10px; align-items: center;">
                    <input type="date" name="preFacilitationDateConductedStart_${fieldsetIndex}" required style="flex: 1;">
                    <span>to</span>
                    <input type="date" name="preFacilitationDateConductedEnd_${fieldsetIndex}" required style="flex: 1;">
                  </div>
              </div>
          </div>
          <h4>Mode</h4>
          <div class="radio-row">
            <label><input type="radio" name="preFacilitationMode_${fieldsetIndex}" value="Face-to-Face" required> Face-to-Face</label>
            <label><input type="radio" name="preFacilitationMode_${fieldsetIndex}" value="Online"> Online</label>
            <label><input type="radio" name="preFacilitationMode_${fieldsetIndex}" value="Hybrid"> Hybrid</label>
          </div>
          <h4>Convergence</h4>
          <div class="checkbox-row">
            <label><input type="checkbox" name="preFacilitationConvergenceNWPC_${fieldsetIndex}"> NWPC/RTWPB</label>
            <label><input type="checkbox" name="preFacilitationConvergenceOSHC_${fieldsetIndex}"> ECC/OSHC</label>
            <label><input type="checkbox" name="preFacilitationConvergenceDOLE_${fieldsetIndex}"> DOLE-RO</label>
            <label><input type="checkbox" name="preFacilitationConvergencePRC_${fieldsetIndex}"> PRC</label>
            <label><input type="checkbox" name="preFacilitationConvergenceTESDA_${fieldsetIndex}"> TESDA</label>
            <label><input type="checkbox" name="preFacilitationConvergenceNLRC_${fieldsetIndex}"> NLRC</label>
            <label><input type="checkbox" name="preFacilitationConvergenceBWC_${fieldsetIndex}"> BWC</label>
            <label><input type="checkbox" name="preFacilitationConvergenceBLR_${fieldsetIndex}"> BLR</label>
            <label><input type="checkbox" id="preFacilitationConvergenceOtherCheckbox_${fieldsetIndex}" name="preFacilitationConvergenceOtherCheckbox_${fieldsetIndex}" onchange="toggleInputFieldVisibility('preFacilitationConvergenceOtherCheckbox_${fieldsetIndex}', 'preFacilitationConvergenceOtherText_${fieldsetIndex}')"> Other</label>
            <input type="text" id="preFacilitationConvergenceOtherText_${fieldsetIndex}" name="preFacilitationConvergenceOtherText_${fieldsetIndex}" class="other-convergence-input hidden-field" placeholder="Specify Other">
          </div>

          <h4>Partnership</h4>
          <div class="partnership-option-row">
            <label><input type="checkbox" id="preFacilitationPartnershipRegionalLMC_${fieldsetIndex}" name="preFacilitationPartnershipRegionalLMC_${fieldsetIndex}" onchange="toggleInputFieldVisibility('preFacilitationPartnershipRegionalLMC_${fieldsetIndex}', 'preFacilitationPartnershipRegionalLMCText_${fieldsetIndex}')"> Regional LMC Association</label>
            <input type="text" id="preFacilitationPartnershipRegionalLMCText_${fieldsetIndex}" name="preFacilitationPartnershipRegionalLMCText_${fieldsetIndex}" class="partnership-input hidden-field" placeholder="Specify Regional LMC Assoc.">
          </div>
          <div class="partnership-option-row">
            <label><input type="checkbox" id="preFacilitationPartnershipOtherSocialPartnersCheckbox_${fieldsetIndex}" name="preFacilitationPartnershipOtherSocialPartnersCheckbox_${fieldsetIndex}" onchange="toggleInputFieldVisibility('preFacilitationPartnershipOtherSocialPartnersCheckbox_${fieldsetIndex}', 'preFacilitationPartnershipOtherSocialPartnersText_${fieldsetIndex}')"> Other Social Partners/Industry Group</label>
            <input type="text" id="preFacilitationPartnershipOtherSocialPartnersText_${fieldsetIndex}" name="preFacilitationPartnershipOtherSocialPartnersText_${fieldsetIndex}" class="partnership-input hidden-field" placeholder="Specify Other Social Partners">
          </div>

          <div class="form-group">
            <label class="bold-label">Details</label>
            <textarea name="preFacilitationDetails_${fieldsetIndex}" rows="4" placeholder="Enter details..."></textarea>
          </div>

          <h3>Discussion Details</h3>
          <table class="pre-facilitation-discussion-table" id="discussionTable_preFacilitation_${fieldsetIndex}">
            <thead>
              <tr>
                <th class="pre-dis-col-category">Topic Category</th>
                <th class="pre-dis-col-topics">Topic/s Discussed</th>
                <th class="pre-dis-col-discussed-by">Discussed by</th>
                <th class="pre-dis-col-details">Details</th>
                <th class="pre-dis-col-remove">Action</th>
              </tr>
            </thead>
            <tbody>
              <!-- Rows added dynamically -->
            </tbody>
          </table>
          <button type="button" class="add-activity-instance-btn" onclick="addDiscussionTableRow('discussionTable_preFacilitation_${fieldsetIndex}', 'preFacilitation', ${fieldsetIndex})">Add Row</button>

          <h3>Participating Companies</h3>
          <table class="company-table pre-facilitation-company-table" id="companyTable_preFacilitation_${fieldsetIndex}">
            <thead>
              <tr>
                <th class="col-company-name">Company Name</th>
                <th class="col-category">Category</th>
                <th class="col-filed-case">With Filed Case?</th>
                <th class="col-filed-rfa">With Filed RFA?</th>
                <th colspan="3" class="col-participants-header">No. of Participants<br><span class="sub-header-text">(Male / Female / Total)</span></th>
                <th class="col-iec-materials">No. of IEC Materials Provided</th>
                <th class="col-remove">Action</th>
              </tr>
            </thead>
            <tbody>
              <!-- Initial row for the company table -->
            </tbody>
          </table>
          <button type="button" class="add-activity-instance-btn" onclick="addCompanyTableRow('companyTable_preFacilitation_${fieldsetIndex}', 'preFacilitation', ${fieldsetIndex})">Add Company</button>
          <button type="button" class="remove-activity-fieldset-btn" onclick="showConfirmationModal(this)">Remove Activity</button>
        </fieldset>
      `;
    }

    function generateEnhancementFields(fieldsetIndex) {
      window[`companyTableRowCount_enhancement_${fieldsetIndex}`] = 0;
      enhancementDiscussionRowCount[fieldsetIndex] = 0;

      return `
        <fieldset class="activity-fieldset">
          <legend>ENHANCEMENT ACTIVITY ${fieldsetIndex + 1}</legend>
          <div class="form-group">
            <label>Activity</label>
            <select name="enhancementActivityType_${fieldsetIndex}" required>
              <option value="">Select Activity</option>
              <option value="Training">Training</option>
              <option value="Workshop">Workshop</option>
              <option value="Seminar">Seminar</option>
            </select>
          </div>
          <div class="row">
              <div class="form-group">
                  <label>Activity Title</label>
                  <input type="text" name="enhancementActivityTitle_${fieldsetIndex}" required>
              </div>
              <div class="form-group">
                  <label>Date Conducted</label>
                  <div style="display: flex; gap: 10px; align-items: center;">
                    <input type="date" name="enhancementDateConductedStart_${fieldsetIndex}" required style="flex: 1;">
                    <span>to</span>
                    <input type="date" name="enhancementDateConductedEnd_${fieldsetIndex}" required style="flex: 1;">
                  </div>
              </div>
          </div>
          <div class="row">
              <div class="form-group" style="flex-direction: row; align-items: center; gap: 10px;">
                  <label style="margin-bottom: 0; font-weight: bold;">Cascaded with basic concepts of productivity in SMEs?</label>
                  <label><input type="radio" name="enhancementCascadedSME_${fieldsetIndex}" value="Yes" required> Yes</label>
                  <label><input type="radio" name="enhancementCascadedSME_${fieldsetIndex}" value="No"> No</label>
              </div>
          </div>
          <h4>Mode</h4>
          <div class="radio-row">
            <label><input type="radio" name="enhancementMode_${fieldsetIndex}" value="Face-to-Face" required> Face-to-Face</label>
            <label><input type="radio" name="enhancementMode_${fieldsetIndex}" value="Online"> Online</label>
            <label><input type="radio" name="enhancementMode_${fieldsetIndex}" value="Hybrid"> Hybrid</label>
          </div>
          <h4>Convergence</h4>
          <div class="checkbox-row">
            <label><input type="checkbox" name="enhancementConvergenceNWPC_${fieldsetIndex}"> NWPC/RTWPB</label>
            <label><input type="checkbox" name="enhancementConvergenceOSHC_${fieldsetIndex}"> ECC/OSHC</label>
            <label><input type="checkbox" name="enhancementConvergenceDOLE_${fieldsetIndex}"> DOLE-RO</label>
            <label><input type="checkbox" name="enhancementConvergencePRC_${fieldsetIndex}"> PRC</label>
            <label><input type="checkbox" name="enhancementConvergenceTESDA_${fieldsetIndex}"> TESDA</label>
            <label><input type="checkbox" name="enhancementConvergenceNLRC_${fieldsetIndex}"> NLRC</label>
            <label><input type="checkbox" name="enhancementConvergenceBWC_${fieldsetIndex}"> BWC</label>
            <label><input type="checkbox" name="enhancementConvergenceBLR_${fieldsetIndex}"> BLR</label>
            <label><input type="checkbox" id="enhancementConvergenceOtherCheckbox_${fieldsetIndex}" name="enhancementConvergenceOtherCheckbox_${fieldsetIndex}" onchange="toggleInputFieldVisibility('enhancementConvergenceOtherCheckbox_${fieldsetIndex}', 'enhancementConvergenceOtherText_${fieldsetIndex}')"> Other</label>
            <input type="text" id="enhancementConvergenceOtherText_${fieldsetIndex}" name="enhancementConvergenceOtherText_${fieldsetIndex}" class="other-convergence-input hidden-field" placeholder="Specify Other">
          </div>

          <h4>Partnership</h4>
          <div class="partnership-option-row">
            <label><input type="checkbox" id="enhancementPartnershipRegionalLMC_${fieldsetIndex}" name="enhancementPartnershipRegionalLMC_${fieldsetIndex}" onchange="toggleInputFieldVisibility('enhancementPartnershipRegionalLMC_${fieldsetIndex}', 'enhancementPartnershipRegionalLMCText_${fieldsetIndex}')"> Regional LMC Association</label>
            <input type="text" id="enhancementPartnershipRegionalLMCText_${fieldsetIndex}" name="enhancementPartnershipRegionalLMCText_${fieldsetIndex}" class="partnership-input hidden-field" placeholder="Specify Regional LMC Assoc.">
          </div>
          <div class="partnership-option-row">
            <label><input type="checkbox" id="enhancementPartnershipOtherSocialPartnersCheckbox_${fieldsetIndex}" name="enhancementPartnershipOtherSocialPartnersCheckbox_${fieldsetIndex}" onchange="toggleInputFieldVisibility('enhancementPartnershipOtherSocialPartnersCheckbox_${fieldsetIndex}', 'enhancementPartnershipOtherSocialPartnersText_${fieldsetIndex}')"> Other Social Partners/Industry Group</label>
            <input type="text" id="enhancementPartnershipOtherSocialPartnersText_${fieldsetIndex}" name="enhancementPartnershipOtherSocialPartnersText_${fieldsetIndex}" class="partnership-input hidden-field" placeholder="Specify Other Social Partners">
          </div>

          <div class="form-group">
            <label class="bold-label">Details</label>
            <textarea name="enhancementDetails_${fieldsetIndex}" rows="4" placeholder="Enter details..."></textarea>
          </div>

          <h3>Discussion Details</h3>
          <table class="enhancement-discussion-table" id="discussionTable_enhancement_${fieldsetIndex}">
            <thead>
              <tr>
                <th class="enh-dis-col-category">Topic Category</th>
                <th class="enh-dis-col-topics">Topic/s Discussed</th>
                <th class="enh-dis-col-discussed-by">Discussed by</th>
                <th class="enh-dis-col-details">Details</th>
                <th class="enh-dis-col-remove">Action</th>
              </tr>
            </thead>
            <tbody>
              <!-- Rows added dynamically -->
            </tbody>
          </table>
          <button type="button" class="add-activity-instance-btn" onclick="addDiscussionTableRow('discussionTable_enhancement_${fieldsetIndex}', 'enhancement', ${fieldsetIndex})">Add Row</button>

          <h3>Participating Companies</h3>
          <table class="company-table enhancement-company-table" id="companyTable_enhancement_${fieldsetIndex}">
            <thead>
              <tr>
                <th class="col-company-name">Company Name</th>
                <th class="col-lmc-name">LMC Name</th>
                <th class="col-category">Category</th>
                <th class="col-filed-case">With Filed Case?</th>
                <th class="col-filed-rfa">With Filed RFA?</th>
                <th colspan="3" class="col-participants-header">No. of Participants<br><span class="sub-header-text">(Male / Female / Total)</span></th>
                <th class="col-iec-materials">No. of IEC Materials Provided</th>
                <th class="col-remove">Action</th>
              </tr>
            </thead>
            <tbody>
              <!-- Initial row for the company table -->
            </tbody>
          </table>
          <button type="button" class="add-activity-instance-btn" onclick="addCompanyTableRow('companyTable_enhancement_${fieldsetIndex}', 'enhancement', ${fieldsetIndex})">Add Company</button>
          <button type="button" class="remove-activity-fieldset-btn" onclick="showConfirmationModal(this)">Remove Activity</button>
        </fieldset>
      `;
    }

    function generateMonitoringFields(fieldsetIndex) {
      monitoringLmcProjectRowCount[fieldsetIndex] = 0;
      issuesAddressedRowCount[fieldsetIndex] = 0;

      return `
        <fieldset class="activity-fieldset">
          <legend>MONITORING ACTIVITY ${fieldsetIndex + 1}</legend>
          <div class="form-group">
            <label for="monitoringCompanyName_${fieldsetIndex}">Company Name</label>
            <select id="monitoringCompanyName_${fieldsetIndex}" name="monitoringCompanyName_${fieldsetIndex}" onchange="loadLMCsForCompany(this, 'monitoring', ${fieldsetIndex})" required>
              <option value="">Select Company</option>
            </select>
          </div>
          <div class="form-group">
            <label for="monitoringLmcName_${fieldsetIndex}">LMC Name</label>
            <select id="monitoringLmcName_${fieldsetIndex}" name="monitoringLmcName_${fieldsetIndex}" required>
              <option value="">Select LMC</option>
            </select>
          </div>
          <div class="form-group">
            <label for="monitoringDateMonitored_${fieldsetIndex}">Date Monitored</label>
            <input type="date" id="monitoringDateMonitored_${fieldsetIndex}" name="monitoringDateMonitored_${fieldsetIndex}" required>
          </div>
          
          <div class="form-group">
            <label for="monitoringIssues_${fieldsetIndex}">Issue/Difficulties experienced/encountered by the LMCs</label>
            <textarea id="monitoringIssues_${fieldsetIndex}" name="monitoringIssues_${fieldsetIndex}" rows="3" placeholder="Enter issues/difficulties..."></textarea>
          </div>
          <div class="form-group">
            <label for="monitoringAssistance_${fieldsetIndex}">Assistance/Solutions rendered by the RB</label>
            <textarea id="monitoringAssistance_${fieldsetIndex}" name="monitoringAssistance_${fieldsetIndex}" rows="3" placeholder="Enter assistance/solutions..."></textarea>
          </div>

          <h4>Type of Monitoring</h4>
          <div class="checkbox-row">
            <label><input type="checkbox" name="monitoringFacilitation_${fieldsetIndex}"> Facilitation</label>
            <label><input type="checkbox" name="monitoringPartnering_${fieldsetIndex}"> Partnering</label>
            <label><input type="checkbox" name="monitoringCooperativeProblemSolving_${fieldsetIndex}"> Cooperative Problem Solving</label>
            <label><input type="checkbox" name="monitoringLMCsWithCSR_${fieldsetIndex}"> LMCs with CSR</label>
            <label><input type="checkbox" id="monitoringDelistedInactiveCheckbox_${fieldsetIndex}" name="monitoringDelistedInactive_${fieldsetIndex}" onchange="toggleDelistedInactiveFields(this, ${fieldsetIndex})"> Delisted/ Inactive</label>
          </div>
          <div id="monitoringDelistedInactiveDetails_${fieldsetIndex}" class="deletion-details hidden-field">
            <div class="form-group">
                <label for="monitoringDateDeleted_${fieldsetIndex}">Date Deleted</label>
                <input type="date" id="monitoringDateDeleted_${fieldsetIndex}" name="monitoringDateDeleted_${fieldsetIndex}">
            </div>
            <div class="form-group">
                <label for="monitoringReasonForDeletion_${fieldsetIndex}">Reason for Deletion</label>
                <textarea id="monitoringReasonForDeletion_${fieldsetIndex}" name="monitoringReasonForDeletion_${fieldsetIndex}" rows="2" placeholder="Enter reason for deletion..."></textarea>
            </div>
          </div>

          <!-- LMC Projects Implemented Section -->
          <div class="autofill-company-box">
            <h3>LMC Projects Implemented</h3>
            <table class="lmc-project-table" id="lmcProjectsTable_${fieldsetIndex}">
              <thead>
                <tr>
                  <th class="col-lmc-project">LMC Project</th>
                  <th class="col-project-title">Project Title</th>
                  <th class="col-date-implemented">Date Implemented</th>
                  <th class="col-details">Details</th>
                  <th class="col-action">Action</th>
                </tr>
              </thead>
              <tbody>
                <!-- Rows added dynamically -->
              </tbody>
            </table>
            <button type="button" class="add-activity-instance-btn" onclick="addLmcProjectTableRow('lmcProjectsTable_${fieldsetIndex}', ${fieldsetIndex})">Add Row</button>
          </div>

          <!-- Issues Addressed Section -->
          <div class="autofill-company-box">
            <h3>Issues Addressed (please list specific issues (grievance or not))</h3>
            <table class="issues-addressed-table" id="issuesAddressedTable_${fieldsetIndex}">
              <thead>
                <tr>
                  <th class="col-issues-topics">Issues/Topics</th>
                  <th class="col-date-raised">Date Raised or Discussed</th>
                  <th class="col-date-settled">Date Settled or Resolved</th>
                  <th class="col-date-elevated">If unsettled, date elevated to GM</th>
                  <th class="col-date-settled-gm">Date settled through GM</th>
                  <th class="col-referred-forums">Referred to other Forums<br><span class="smaller-italic-text">(please specify forum and date)</span></th>
                  <th class="col-action">Action</th>
                </tr>
              </thead>
              <tbody>
                <!-- Rows added dynamically -->
              </tbody>
            </table>
            <button type="button" class="add-activity-instance-btn" onclick="addIssuesAddressedTableRow('issuesAddressedTable_${fieldsetIndex}', ${fieldsetIndex})">Add Row</button>
          </div>

          <!-- Remarks Section -->
          <div class="autofill-company-box">
            <h3>Remarks</h3>
            <div class="form-group">
              <textarea id="monitoringRemarks_${fieldsetIndex}" name="monitoringRemarks_${fieldsetIndex}" rows="3" placeholder="Enter remarks..."></textarea>
            </div>
          </div>

          <!-- Autofilled Company Details Container -->
          <div class="autofill-company-box">
            <h3>Company Details (Autofilled)</h3>
            <div class="row">
              <div class="form-group">
                <label for="monitoringCategory_${fieldsetIndex}">Category</label>
                <select id="monitoringCategory_${fieldsetIndex}" name="monitoringCategory_${fieldsetIndex}" readonly>
                  <option value="">Select...</option>
                  <option value="Organized">Organized</option>
                  <option value="Unorganized">Unorganized</option>
                </select>
              </div>
              <div class="form-group">
                <label for="monitoringAcronym_${fieldsetIndex}">Acronym</label>
                <input type="text" id="monitoringAcronym_${fieldsetIndex}" name="monitoringAcronym_${fieldsetIndex}" readonly>
              </div>
            </div>
            <div class="row">
              <div class="form-group">
                <label for="monitoringFiledCase_${fieldsetIndex}">With Filed Case?</label>
                <select id="monitoringFiledCase_${fieldsetIndex}" name="monitoringFiledCase_${fieldsetIndex}" readonly>
                  <option value="">Select...</option>
                  <option value="Yes">Yes</option>
                  <option value="No">No</option>
                </select>
              </div>
              <div class="form-group">
                <label for="monitoringFiledRFA_${fieldsetIndex}">With Filed RFA?</label>
                <select id="monitoringFiledRFA_${fieldsetIndex}" name="monitoringFiledRFA_${fieldsetIndex}" readonly>
                  <option value="">Select...</option>
                  <option value="Yes">Yes</option>
                  <option value="No">No</option>
                </select>
              </div>
            </div>

            <!-- Company Address (Autofilled) -->
            <h3>Company Address (Autofilled)</h3>
            <div class="row">
              <div class="form-group"><label for="monitoringBuilding_${fieldsetIndex}">Building No.</label><input type="text" id="monitoringBuilding_${fieldsetIndex}" name="monitoringBuilding_${fieldsetIndex}" readonly></div>
              <div class="form-group"><label for="monitoringStreet_${fieldsetIndex}">Street</label><input type="text" id="monitoringStreet_${fieldsetIndex}" name="monitoringStreet_${fieldsetIndex}" readonly></div>
              <div class="form-group"><label for="monitoringBarangay_${fieldsetIndex}">Barangay</label><input type="text" id="monitoringBarangay_${fieldsetIndex}" name="monitoringBarangay_${fieldsetIndex}" readonly></div>
            </div>
            <div class="row">
              <div class="form-group"><label for="monitoringMunicipality_${fieldsetIndex}">Municipality</label><input type="text" id="monitoringMunicipality_${fieldsetIndex}" name="monitoringMunicipality_${fieldsetIndex}" readonly></div>
              <div class="form-group"><label for="monitoringProvince_${fieldsetIndex}">Province/City</label><input type="text" id="monitoringProvince_${fieldsetIndex}" name="monitoringProvince_${fieldsetIndex}" readonly></div>
              <div class="form-group">
                <label for="monitoringEcozone_${fieldsetIndex}">Ecozone</label>
                <select id="monitoringEcozone_${fieldsetIndex}" name="monitoringEcozone_${fieldsetIndex}" readonly>
                  <option value="">Select...</option>
                  <option value="Yes">Yes</option>
                  <option value="No">No</option>
                </select>
              </div>
            </div>

            <!-- Industry (Autofilled & Editable) -->
            <h3>Industry</h3>
            <div class="row">
              <div class="form-group">
                  <label for="monitoringIndustrySection_${fieldsetIndex}">Section</label>
                  <select id="monitoringIndustrySection_${fieldsetIndex}" name="monitoringIndustrySection_${fieldsetIndex}" onchange="updateIndustryDropdowns(${fieldsetIndex}, 'monitoring')">
                      <option value="">Select Section</option>
                  </select>
              </div>
              <div class="form-group">
                  <label for="monitoringIndustryDivision_${fieldsetIndex}">Division</label>
                  <select id="monitoringIndustryDivision_${fieldsetIndex}" name="monitoringIndustryDivision_${fieldsetIndex}" onchange="updateIndustryDropdowns(${fieldsetIndex}, 'monitoring')">
                      <option value="">Select Division</option>
                  </select>
              </div>
            </div>
            <div class="row">
              <div class="form-group">
                  <label for="monitoringIndustryGroup_${fieldsetIndex}">Group</label>
                  <select id="monitoringIndustryGroup_${fieldsetIndex}" name="monitoringIndustryGroup_${fieldsetIndex}" onchange="updateIndustryDropdowns(${fieldsetIndex}, 'monitoring')">
                      <option value="">Select Group</option>
                  </select>
              </div>
              <div class="form-group">
                  <label for="monitoringIndustryClass_${fieldsetIndex}">Class</label>
                  <select id="monitoringIndustryClass_${fieldsetIndex}" name="monitoringIndustryClass_${fieldsetIndex}" onchange="updateIndustryDropdowns(${fieldsetIndex}, 'monitoring')">
                      <option value="">Select Class</option>
                  </select>
              </div>
              <div class="form-group">
                  <label for="monitoringIndustrySubclass_${fieldsetIndex}">Subclass</label>
                  <select id="monitoringIndustrySubclass_${fieldsetIndex}" name="monitoringIndustrySubclass_${fieldsetIndex}">
                      <option value="">Select Subclass</option>
                  </select>
              </div>
            </div>
          </div>
          <button type="button" class="remove-activity-fieldset-btn" onclick="showConfirmationModal(this)">Remove Activity</button>
        </fieldset>
      `;
    }

    function generateOtherAdvocacyNetworkingFields(fieldsetIndex) {
        return `
            <fieldset class="activity-fieldset">
                <legend>OTHER ADVOCACY & NETWORKING ACTIVITIES ${fieldsetIndex + 1}</legend>
                <div class="form-group">
                    <label>Activity Title</label>
                    <input type="text" name="otherAdvocacyActivityTitle_${fieldsetIndex}" required>
                </div>
                <div class="row">
                    <div class="form-group">
                        <label>Date Conducted</label>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="date" name="otherAdvocacyDateConductedStart_${fieldsetIndex}" required style="flex: 1;">
                            <span>to</span>
                            <input type="date" name="otherAdvocacyDateConductedEnd_${fieldsetIndex}" required style="flex: 1;">
                        </div>
                    </div>
                </div>
                <h4>Details</h4>
                <div class="form-group">
                    <textarea name="otherAdvocacyDetails_${fieldsetIndex}" rows="4" placeholder="Enter details..."></textarea>
                </div>
                <button type="button" class="remove-activity-fieldset-btn" onclick="showConfirmationModal(this)">Remove Activity</button>
            </fieldset>
        `;
    }


    function addCompanyTableRow(tableId, type, fieldsetIndex) {
      const table = document.getElementById(tableId);
      if (!table) return console.error(`Table with ID '${tableId}' not found.`);
      const tbody = table.querySelector('tbody');
      const rowIndex = window[`companyTableRowCount_${type}_${fieldsetIndex}`]++;

      const newRow = document.createElement('tr');
      let rowHtml = '';

      if (type === 'preFacilitation') {
        rowHtml += `
          <td><input type="text" name="${tableId}_companyName_${rowIndex}" required></td>`;
      } else if (type === 'enhancement') {
        rowHtml += `
          <td>
            <select name="${tableId}_companyName_${rowIndex}" onchange="loadLMCsForCompany(this, '${type}', ${fieldsetIndex}, ${rowIndex})" required>
              <option value="">Select Company</option>
            </select>
          </td>
          <td>
            <select name="${tableId}_lmcName_${rowIndex}" required>
              <option value="">Select LMC</option>
            </select>
          </td>`;
      }

      rowHtml += `
          <td>
            <select name="${tableId}_category_${rowIndex}" required>
              <option value="">Select</option>
              <option value="Organized">Organized</option>
              <option value="Unorganized">Unorganized</option>
            </select>
          </td>
          <td>
            <select name="${tableId}_filedCase_${rowIndex}" required>
              <option value="">Select</option>
              <option value="Yes">Yes</option>
              <option value="No">No</option>
            </select>
          </td>
          <td>
            <select name="${tableId}_filedRFA_${rowIndex}" required>
              <option value="">Select</option>
              <option value="Yes">Yes</option>
              <option value="No">No</option>
            </select>
          </td>
          <td><input type="number" name="${tableId}_maleParticipants_${rowIndex}" oninput="updateCompanyTotalParticipants(this, '${type}', ${fieldsetIndex}, ${rowIndex})" value="0"></td>
          <td><input type="number" name="${tableId}_femaleParticipants_${rowIndex}" oninput="updateCompanyTotalParticipants(this, '${type}', ${fieldsetIndex}, ${rowIndex})" value="0"></td>
          <td><input type="number" name="${tableId}_totalParticipants_${rowIndex}" readonly value="0"></td>
          <td><input type="number" name="${tableId}_iecMaterials_${rowIndex}" value="0"></td>
          <td class="remove-cell">
            <button type="button" onclick="showConfirmationModal(this)">Remove</button>
          </td>
      `;
      newRow.innerHTML = rowHtml;
      tbody.appendChild(newRow);

      if (type === 'enhancement') {
          const companySelect = newRow.querySelector(`select[name="${tableId}_companyName_${rowIndex}"]`);
          if (companySelect) {
              loadCompanies(companySelect);
          }
      }
    }

    function addDiscussionTableRow(tableId, type, fieldsetIndex) {
        const table = document.getElementById(tableId);
        if (!table) return console.error(`Table with ID '${tableId}' not found.`);
        const tbody = table.querySelector('tbody');
        let rowIndex;

        if (type === 'preFacilitation') {
            rowIndex = preFacilitationDiscussionRowCount[fieldsetIndex]++;
        } else if (type === 'enhancement') {
            rowIndex = enhancementDiscussionRowCount[fieldsetIndex]++;
        } else {
            console.error("Invalid activity type for discussion table.");
            return;
        }

        const newRow = document.createElement('tr');
        newRow.innerHTML = `
            <td>
              <select name="${tableId}_topicCategory_${rowIndex}" required>
                <option value="">Select Category</option>
                <option value="LMC">LMC</option>
                <option value="GM">GM</option>
                <option value="GAD">GAD</option>
                <option value="Others">Others</option>
              </select>
            </td>
            <td><input type="text" name="${tableId}_topicsDiscussed_${rowIndex}" required></td>
            <td><input type="text" name="${tableId}_discussedBy_${rowIndex}" required></td>
            <td><textarea name="${tableId}_details_${rowIndex}" rows="1" placeholder="Enter details..."></textarea></td>
            <td class="remove-cell">
                <button type="button" onclick="showConfirmationModal(this)">Remove</button>
            </td>
        `;
        tbody.appendChild(newRow);
    }

    function addLmcProjectTableRow(tableId, fieldsetIndex) {
        const table = document.getElementById(tableId);
        if (!table) return console.error(`Table with ID '${tableId}' not found.`);
        const tbody = table.querySelector('tbody');
        const rowIndex = monitoringLmcProjectRowCount[fieldsetIndex]++;

        const newRow = document.createElement('tr');
        newRow.innerHTML = `
            <td>
              <select name="${tableId}_lmcProject_${rowIndex}" required>
                <option value="">Select Project Type</option>
                <option value="Health and Safety">Health and Safety</option>
                <option value="Livelihood">Livelihood</option>
                <option value="Sports and Recreation">Sports and Recreation</option>
                <option value="Productivity/Quality">Productivity/Quality</option>
                <option value="Community and Environment Relations">Community and Environment Relations</option>
                <option value="Gender and Development">Gender and Development</option>
                <option value="Family Welfare">Family Welfare</option>
                <option value="Grievance Machinery/Disciplinary Committee">Grievance Machinery/Disciplinary Committee</option>
              </select>
            </td>
            <td><input type="text" name="${tableId}_projectTitle_${rowIndex}" required></td>
            <td><input type="date" name="${tableId}_dateImplemented_${rowIndex}" required></td>
            <td><textarea name="${tableId}_details_${rowIndex}" rows="1" placeholder="Enter details..."></textarea></td>
            <td class="remove-cell">
                <button type="button" onclick="showConfirmationModal(this)">Remove</button>
            </td>
        `;
        tbody.appendChild(newRow);
    }

    function addIssuesAddressedTableRow(tableId, fieldsetIndex) {
        const table = document.getElementById(tableId);
        if (!table) return console.error(`Table with ID '${tableId}' not found.`);
        const tbody = table.querySelector('tbody');
        const rowIndex = issuesAddressedRowCount[fieldsetIndex]++;

        const newRow = document.createElement('tr');
        newRow.innerHTML = `
            <td><input type="text" name="${tableId}_issuesTopics_${rowIndex}" required></td>
            <td><input type="date" name="${tableId}_dateRaised_${rowIndex}"></td>
            <td><input type="date" name="${tableId}_dateSettled_${rowIndex}"></td>
            <td><input type="date" name="${tableId}_dateElevatedGM_${rowIndex}"></td>
            <td><input type="date" name="${tableId}_dateSettledGM_${rowIndex}"></td>
            <td><input type="text" name="${tableId}_referredForums_${rowIndex}" placeholder="(specify forum and date)"></td>
            <td class="remove-cell">
                <button type="button" onclick="showConfirmationModal(this)">Remove</button>
            </td>
        `;
        tbody.appendChild(newRow);
    }


    function toggleDelistedInactiveFields(checkboxElement, fieldsetIndex) {
        const deletionDetailsDiv = document.getElementById(`monitoringDelistedInactiveDetails_${fieldsetIndex}`);
        const dateInput = deletionDetailsDiv.querySelector(`input[name="monitoringDateDeleted_${fieldsetIndex}"]`);
        const reasonTextarea = deletionDetailsDiv.querySelector(`textarea[name="monitoringReasonForDeletion_${fieldsetIndex}"]`);

        if (checkboxElement.checked) {
            deletionDetailsDiv.classList.remove('hidden-field');
            dateInput.setAttribute('required', 'true');
            reasonTextarea.setAttribute('required', 'true');
        } else {
            deletionDetailsDiv.classList.add('hidden-field');
            dateInput.removeAttribute('required');
            reasonTextarea.removeAttribute('required');
            dateInput.value = '';
            reasonTextarea.value = '';
        }
    }


    function updateCompanyTotalParticipants(inputElement, type, fieldsetIndex, rowIndex) {
      const maleInput = document.querySelector(`[name="companyTable_${type}_${fieldsetIndex}_maleParticipants_${rowIndex}"]`);
      const femaleInput = document.querySelector(`[name="companyTable_${type}_${fieldsetIndex}_femaleParticipants_${rowIndex}"]`);
      const totalInput = document.querySelector(`[name="companyTable_${type}_${fieldsetIndex}_totalParticipants_${rowIndex}"]`);

      const male = parseInt(maleInput.value) || 0;
      const female = parseInt(femaleInput.value) || 0;
      totalInput.value = male + female;
    }

    function loadCompanies(selectElement) {
        selectElement.innerHTML = '<option value="">Select Company</option>';
        MOCK_COMPANIES.forEach(company => {
            selectElement.add(new Option(company, company));
        });
    }

    function loadLMCsForCompany(companySelectElement, type, fieldsetIndex, rowIndex = null) {
        const selectedCompany = companySelectElement.value;
        let lmcSelectElement;

        if (rowIndex !== null) {
            lmcSelectElement = document.querySelector(`select[name="companyTable_${type}_${fieldsetIndex}_lmcName_${rowIndex}"]`);
        } else {
            lmcSelectElement = document.querySelector(`select[name="${type}LmcName_${fieldsetIndex}"]`);
        }
        
        lmcSelectElement.innerHTML = '<option value="">Select LMC</option>';

        if (selectedCompany) {
            const lmcs = MOCK_COMPANY_LMC_DATA[selectedCompany] || [];
            lmcs.forEach(lmc => {
                lmcSelectElement.add(new Option(lmc, lmc));
            });
        }
        if (type === 'monitoring') {
            autofillMonitoringCompanyDetails(selectedCompany, lmcSelectElement.value, fieldsetIndex);
        }
    }

    function autofillMonitoringCompanyDetails(companyName, lmcName, fieldsetIndex) {
        const companyDetails = MOCK_FULL_COMPANY_DETAILS[companyName] ? MOCK_FULL_COMPANY_DETAILS[companyName][lmcName] : null;

        const categorySelect = document.getElementById(`monitoringCategory_${fieldsetIndex}`);
        const acronymInput = document.getElementById(`monitoringAcronym_${fieldsetIndex}`);
        const filedCaseSelect = document.getElementById(`monitoringFiledCase_${fieldsetIndex}`);
        const filedRFADropdown = document.getElementById(`monitoringFiledRFA_${fieldsetIndex}`);
        
        const buildingInput = document.getElementById(`monitoringBuilding_${fieldsetIndex}`);
        const streetInput = document.getElementById(`monitoringStreet_${fieldsetIndex}`);
        const barangayInput = document.getElementById(`monitoringBarangay_${fieldsetIndex}`);
        const municipalityInput = document.getElementById(`monitoringMunicipality_${fieldsetIndex}`);
        const provinceInput = document.getElementById(`monitoringProvince_${fieldsetIndex}`);
        const ecozoneSelect = document.getElementById(`monitoringEcozone_${fieldsetIndex}`);

        const sectionSelect = document.getElementById(`monitoringIndustrySection_${fieldsetIndex}`);
        const divisionSelect = document.getElementById(`monitoringIndustryDivision_${fieldsetIndex}`);
        const groupSelect = document.getElementById(`monitoringIndustryGroup_${fieldsetIndex}`);
        const classSelect = document.getElementById(`monitoringIndustryClass_${fieldsetIndex}`);
        const subclassSelect = document.getElementById(`monitoringIndustrySubclass_${fieldsetIndex}`);


        if (companyDetails) {
            populateSelect(categorySelect, ['Organized', 'Unorganized'], companyDetails.category);
            acronymInput.value = companyDetails.acronym || '';
            populateSelect(filedCaseSelect, ['Yes', 'No'], companyDetails.filedCase);
            populateSelect(filedRFADropdown, ['Yes', 'No'], companyDetails.filedRFA);

            buildingInput.value = companyDetails.address.building || '';
            streetInput.value = companyDetails.address.street || '';
            barangayInput.value = companyDetails.address.barangay || '';
            municipalityInput.value = companyDetails.address.municipality || '';
            provinceInput.value = companyDetails.address.province || '';
            populateSelect(ecozoneSelect, ['Yes', 'No'], companyDetails.address.ecozone);

            populateSelect(sectionSelect, Object.keys(industryData), companyDetails.industry.section);
            updateIndustryDropdowns(fieldsetIndex, 'monitoring');
            populateSelect(divisionSelect, Object.keys(industryData[companyDetails.industry.section] || {}), companyDetails.industry.division);
            populateSelect(groupSelect, Object.keys(industryData[companyDetails.industry.section]?.[companyDetails.industry.division] || {}), companyDetails.industry.group);
            populateSelect(classSelect, Object.keys(industryData[companyDetails.industry.section]?.[companyDetails.industry.division]?.[companyDetails.industry.group] || {}), companyDetails.industry.class);
            populateSelect(subclassSelect, industryData[companyDetails.industry.section]?.[companyDetails.industry.division]?.[companyDetails.industry.group]?.[companyDetails.industry.class] || [], companyDetails.industry.subclass);

        } else {
            categorySelect.value = '';
            acronymInput.value = '';
            filedCaseSelect.value = '';
            filedRFADropdown.value = '';

            buildingInput.value = '';
            streetInput.value = '';
            barangayInput.value = '';
            municipalityInput.value = '';
            provinceInput.value = '';
            ecozoneSelect.value = '';

            populateSelect(sectionSelect, Object.keys(industryData));
            populateSelect(divisionSelect, []);
            populateSelect(groupSelect, []);
            populateSelect(classSelect, []);
            populateSelect(subclassSelect, []);
        }
    }


    function addPreFacilitationActivityInstance() {
      const container = document.getElementById('activityFieldsContainer');
      const newFieldsetContainer = document.createElement('div');
      newFieldsetContainer.innerHTML = generatePreFacilitationFields(preFacilitationActivityCount);
      
      container.appendChild(newFieldsetContainer);
      
      addCompanyTableRow(`companyTable_preFacilitation_${preFacilitationActivityCount}`, 'preFacilitation', preFacilitationActivityCount);
      addDiscussionTableRow(`discussionTable_preFacilitation_${preFacilitationActivityCount}`, 'preFacilitation', preFacilitationActivityCount);

      preFacilitationActivityCount++;
      const addInstanceButton = document.getElementById('addActivityInstanceButton');
      if (addInstanceButton) {
          container.appendChild(addInstanceButton);
      }
    }

    function addEnhancementActivityInstance() {
      const container = document.getElementById('activityFieldsContainer');
      const newFieldsetContainer = document.createElement('div');
      newFieldsetContainer.innerHTML = generateEnhancementFields(enhancementActivityCount);
      
      container.appendChild(newFieldsetContainer);
      
      addCompanyTableRow(`companyTable_enhancement_${enhancementActivityCount}`, 'enhancement', enhancementActivityCount);
      addDiscussionTableRow(`discussionTable_enhancement_${enhancementActivityCount}`, 'enhancement', enhancementActivityCount);

      enhancementActivityCount++;
      const addInstanceButton = document.getElementById('addActivityInstanceButton');
      if (addInstanceButton) {
          container.appendChild(addInstanceButton);
      }
    }

    function addMonitoringActivityInstance() {
      const container = document.getElementById('activityFieldsContainer');
      const newFieldsetContainer = document.createElement('div');
      newFieldsetContainer.innerHTML = generateMonitoringFields(monitoringActivityCount);
      
      container.appendChild(newFieldsetContainer);
      
      const companySelect = newFieldsetContainer.querySelector(`select[name="monitoringCompanyName_${monitoringActivityCount}"]`);
      if (companySelect) {
          loadCompanies(companySelect);
      }
      addLmcProjectTableRow(`lmcProjectsTable_${monitoringActivityCount}`, monitoringActivityCount);
      addIssuesAddressedTableRow(`issuesAddressedTable_${monitoringActivityCount}`, monitoringActivityCount);

      monitoringActivityCount++;
      const addInstanceButton = document.getElementById('addActivityInstanceButton');
      if (addInstanceButton) {
          container.appendChild(addInstanceButton);
      }
    }

    function addOtherAdvocacyNetworkingInstance() {
        const container = document.getElementById('activityFieldsContainer');
        const newFieldsetContainer = document.createElement('div');
        newFieldsetContainer.innerHTML = generateOtherAdvocacyNetworkingFields(otherAdvocacyNetworkingCount);

        container.appendChild(newFieldsetContainer);
        
        otherAdvocacyNetworkingCount++;
        const addInstanceButton = document.getElementById('addActivityInstanceButton');
        if (addInstanceButton) {
            container.appendChild(addInstanceButton);
        }
    }

    function removeRow(targetElement) {
      if (targetElement) {
        targetElement.remove();
      }
    }

    // Functions for the custom confirmation modal
    function showConfirmationModal(button) {
      elementToRemove = button.closest('tr') || button.closest('.activity-fieldset').parentElement;
      document.getElementById('confirmationOverlay').style.display = 'flex';
    }

    function confirmRemoval() {
      if (elementToRemove) {
        removeRow(elementToRemove);
        elementToRemove = null; // Clear the reference
      }
      document.getElementById('confirmationOverlay').style.display = 'none';
    }

    function cancelRemoval() {
      elementToRemove = null; // Clear the reference
      document.getElementById('confirmationOverlay').style.display = 'none';
    }


    function displayActivityFields() {
      const selectedActivity = document.getElementById('activityTypeSelect').value;
      const container = document.getElementById('activityFieldsContainer');
      container.innerHTML = '';
      preFacilitationActivityCount = 0;
      enhancementActivityCount = 0;
      monitoringActivityCount = 0;
      otherAdvocacyNetworkingCount = 0; // Reset counter for new activity type

      const existingAddInstanceButton = document.getElementById('addActivityInstanceButton');
      if (existingAddInstanceButton) {
          existingAddInstanceButton.remove();
      }

      const addButton = document.createElement('button');
      addButton.type = 'button';
      addButton.className = 'add-activity-instance-btn';
      addButton.id = 'addActivityInstanceButton';

      if (selectedActivity === 'PRE-FACILITATION ACTIVITY') {
        addButton.textContent = 'Add New Pre-Facilitation Activity';
        addButton.onclick = addPreFacilitationActivityInstance;
        container.appendChild(addButton);
        addPreFacilitationActivityInstance();
      } else if (selectedActivity === 'FACILITATION ACTIVITY') {
        container.innerHTML = `
          <fieldset class="activity-fieldset">
            <legend>FACILITATION ACTIVITY Details</legend>
            <p>Fields for FACILITATION ACTIVITY will go here. (Under construction)</p>
          </fieldset>
        `;
      } else if (selectedActivity === 'ENHANCEMENT ACTIVITY') {
        addButton.textContent = 'Add New Enhancement Activity';
        addButton.onclick = addEnhancementActivityInstance;
        container.appendChild(addButton);
        addEnhancementActivityInstance();
      } else if (selectedActivity === 'MONITORING ACTIVITY') {
        addButton.textContent = 'Add New Monitoring Activity';
        addButton.onclick = addMonitoringActivityInstance;
        container.appendChild(addButton);
        addMonitoringActivityInstance();
      } else if (selectedActivity === 'OTHER ADVOCACY & NETWORKING ACTIVITIES') {
        addButton.textContent = 'Add New Other Advocacy & Networking Activity';
        addButton.onclick = addOtherAdvocacyNetworkingInstance;
        container.appendChild(addButton);
        addOtherAdvocacyNetworkingInstance();
      }
    }

    function handleSubmit(event) {
      event.preventDefault();
      document.getElementById("loadingOverlay").style.display = "flex";
      setTimeout(() => {
        document.getElementById("loadingOverlay").style.display = "none";
        alert("Form submitted successfully!");
      }, 2000);
    }
  </script>
</body>
</html>
